<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PROFS TO RATE PH — Home</title>

  <!-- Base design -->
  <link rel="stylesheet" href="css/base.css">
  <!-- Theme loader -->
  <script src="js/theme-loader.js" defer></script>
</head>

<body>
  <!-- ===== HEADER PLACEHOLDER ===== -->
  <div id="header-placeholder"></div>

  <!-- ===== MODAL (single copy) ===== -->
  <div id="modal" class="modal hidden">
    <div class="modal-inner" id="modal-content"></div>
    <button id="modal-close">✕</button>
  </div>

  <!-- ===== CONTENT ===== -->
  <main class="container fade-in">
    <!-- Search -->
   <div class="search-panel" style="position: relative;">
  <input
    id="subject-search"
    type="text"
    placeholder="Search subject or professor..."
    autocomplete="off"
  />
  <div id="index-suggestions" class="suggestions"></div>
  <button id="btn-search">Search</button>
  <button id="btn-list-all">List All Subjects</button>
</div>






    <!-- Cards appear here -->
    <div id="prof-list"></div>
    <div id="subjects-list" class="results"></div>

   
  </main>

  

  <!-- ===== SCRIPTS ===== -->
<!-- 1) Load app.js first (contains initializeHeader and handlers) -->
<script>
  function initChangeSchoolButton() {
    const changeBtn = document.getElementById("change-school-btn");
    if (changeBtn) {
      changeBtn.style.display = "inline-block";
      changeBtn.onclick = () => {
        localStorage.removeItem("selectedSchool");
        window.location.href = "school.html";
      };
      console.log("✅ Change School button initialized");
    } else {
      console.warn("⚠️ Change School button not found");
    }
  }
</script>

<script src="js/app.js"></script>


<script>
  document.addEventListener("DOMContentLoaded", async () => {
    try {
      const res = await fetch("components/header.html");
      const html = await res.text();

      const headerPlaceholder = document.getElementById("header-placeholder");
      headerPlaceholder.innerHTML = html;
      initChangeSchoolButton();


      // ✅ Wait for header elements to exist
      await new Promise(resolve => {
        const check = () => {
          if (document.getElementById("btn-show-login")) resolve();
          else requestAnimationFrame(check);
        };
        check();
      });

      // ✅ Now initialize everything safely
      if (typeof initializeHeader === "function") await initializeHeader();
      if (typeof updateAuthUI === "function") updateAuthUI();

      // ✅ Attach login/signup click events AFTER header loads
      const btnShowLogin = document.getElementById("btn-show-login");
      const btnLogout = document.getElementById("btn-logout");

      if (btnShowLogin) {
        btnShowLogin.onclick = () => {
          const school = localStorage.getItem("selectedSchool") || "dlsu";
          window.location.href = `/auth/google?school=${school}`;
        };
      }

      
      if (btnLogout) {
        btnLogout.onclick = () => {
          localStorage.removeItem("token");
          localStorage.removeItem("user_display");
          updateAuthUI();
          alert("Logged out");
        };
      }

      console.log("✅ Header, Auth UI, and Buttons initialized");

    } catch (err) {
      console.error("❌ Failed to load header:", err);
    }
  });

  function changeSchool() {
    localStorage.removeItem("selectedSchool");
    window.location.href = "school.html";
  }
</script>




</body>
</html>
