<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=1100, initial-scale=0.25, user-scalable=yes" />
  <title>PHrofstopick — Home</title>

  <link rel="icon" type="image/png" href="images/favicon.png">

  <!-- Preload the correct logo before header loads -->
  <script>
    (function preloadLogo() {
      const school = localStorage.getItem('selectedSchool') || 'dlsu';
      const logoMap = {
        dlsu: 'images/dlsu-logo.png',
        ateneo: 'images/ateneo-logo.png',
        benilde: 'images/benilde-logo.png',
        up: 'images/up-logo.png',
      };
      const selectedLogo = logoMap[school] || 'images/default-logo.png';
      const img = new Image();
      img.src = selectedLogo;
      window.__PRELOADED_LOGO = selectedLogo;
    })();
  </script>

  <!-- Base design -->
  <link rel="stylesheet" href="css/base.css">
  <!-- Theme loader -->
  <script src="js/theme-loader.js" defer></script>

  <link rel="stylesheet" href="css/mobile-override.css">
</head>

<body>
  <!-- ===== HEADER PLACEHOLDER ===== -->
  <div id="header-placeholder"></div>

  <!-- ===== MODAL (single copy) ===== -->
  <div id="modal" class="modal hidden">
    <div class="modal-inner" id="modal-content"></div>
    <button id="modal-close">✕</button>
  </div>

  <!-- ===== CONTENT ===== -->
  <main class="container fade-in">
    <!-- Search -->
    <div class="search-panel" style="position: relative;">
      <input
        id="subject-search"
        type="text"
        placeholder="Search subject..."
        autocomplete="off"
      />
      <div id="index-suggestions" class="suggestions"></div>
      <button id="btn-search">Search</button>
      <button id="btn-list-all">List All Subjects</button>
    </div>

    <!-- Cards appear here -->
    <div id="prof-list"></div>
    <div id="subjects-list" class="results"></div>
  </main>

  <!-- ===== SCRIPTS ===== -->
  <script>
    function initChangeSchoolButton() {
      const changeBtn = document.getElementById("change-school-btn");
      if (changeBtn) {
        changeBtn.style.display = "inline-block";
        changeBtn.onclick = () => {
          localStorage.removeItem("selectedSchool");
          window.location.href = "school.html";
        };
        console.log("✅ Change School button initialized");
      } else {
        console.warn("⚠️ Change School button not found");
      }
    }
  </script>

  <script src="js/app.js"></script>

    <!-- remove the static app.js include above (if present) and use this block below -->
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      try {
        // 1) Always fetch header using absolute path so it resolves correctly
        const res = await fetch("/components/header.html");
        if (!res.ok) throw new Error('Failed to fetch header (status ' + res.status + ')');
        const html = await res.text();
        document.getElementById("header-placeholder").innerHTML = html;

        // 2) Initialize any header-only small helpers immediately
        // If initChangeSchoolButton is defined in your app.js, it's safe to call later;
        // we call it if it's already defined. If not, app.js will also call it later.
        try { if (typeof initChangeSchoolButton === 'function') initChangeSchoolButton(); } catch(e) { console.warn(e); }

        // 3) Wait for the key header elements to finish parsing by browser
        await new Promise(resolve => requestAnimationFrame(resolve));

        // 4) Dynamically load the main app.js AFTER the header is inserted.
        // This guarantees that app.js runs after #prof-search / suggestions exist.
        await new Promise((resolve, reject) => {
          const s = document.createElement('script');
          s.src = '/js/app.js';
          s.onload = () => resolve();
          s.onerror = () => reject(new Error('Failed to load /js/app.js'));
          document.head.appendChild(s);
        });

        // 5) After app.js is loaded, call the global initialization functions (if available).
        // app.js defines initializeHeader, updateAuthUI, enableAutocomplete, initializeHeaderSearch, etc.
        if (typeof initializeHeader === "function") await initializeHeader();
        if (typeof updateAuthUI === "function") updateAuthUI();
        // initializeHeaderSearch and enableAutocomplete are safe to call even if they internally retry.
        if (typeof initializeHeaderSearch === "function") initializeHeaderSearch();
        if (typeof enableAutocomplete === "function") {
          enableAutocomplete("subject-search", "index-suggestions");
          enableAutocomplete("prof-search", "header-suggestions");
        }

        console.log("✅ Header injected and app.js loaded and initialized (index).");
      } catch (err) {
        console.error("❌ Failed to load header or app.js:", err);
      }
    });
  </script>

</body>
</html>
