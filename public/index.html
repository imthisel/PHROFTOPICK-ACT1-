<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=1100, initial-scale=0.3, user-scalable=yes" />
  <title>PHrofstopick — Home</title>

  <link rel="icon" type="image/png" href="images/favicon.png">

  <!-- Preload the correct logo before header loads -->
  <script>
    (function preloadLogo() {
      const school = localStorage.getItem('selectedSchool') || 'dlsu';
      const logoMap = {
        dlsu: 'images/dlsu-logo.png',
        ateneo: 'images/ateneo-logo.png',
        benilde: 'images/benilde-logo.png',
        up: 'images/up-logo.png',
      };
      const selectedLogo = logoMap[school] || 'images/default-logo.png';
      const img = new Image();
      img.src = selectedLogo;
      window.__PRELOADED_LOGO = selectedLogo;
    })();
  </script>

  <!-- Base design -->
  <link rel="stylesheet" href="css/base.css">
  <!-- Theme loader -->
  <script src="js/theme-loader.js" defer></script>

  <link rel="stylesheet" href="css/mobile-override.css">
</head>

<body>
  <!-- ===== HEADER PLACEHOLDER ===== -->
  <div id="header-placeholder"></div>

  <!-- ===== MODAL (single copy) ===== -->
  <div id="modal" class="modal hidden">
    <div class="modal-inner" id="modal-content"></div>
    <button id="modal-close">✕</button>
  </div>

  <!-- ===== CONTENT ===== -->
  <main class="container fade-in">
    <!-- Search -->
    <div class="search-panel" style="position: relative;">
      <input
        id="subject-search"
        type="text"
        placeholder="Search subject..."
        autocomplete="off"
      />
      <div id="index-suggestions" class="suggestions"></div>
      <button id="btn-search">Search</button>
      <button id="btn-list-all">List All Subjects</button>
      <button id="btn-create-review" style="margin-left: 10px;">Create Review</button>

    </div>

    <!-- Cards appear here -->
    <div id="prof-list"></div>
    <div id="subjects-list" class="results"></div>
    <div id="review-prof-list" class="results"></div>

  </main>

  <!-- ===== SCRIPTS ===== -->
  <script>
    function initChangeSchoolButton() {
      const changeBtn = document.getElementById("change-school-btn");
      if (changeBtn) {
        changeBtn.style.display = "inline-block";
        changeBtn.onclick = () => {
          localStorage.removeItem("selectedSchool");
          window.location.href = "school.html";
        };
        console.log("✅ Change School button initialized");
      } else {
        console.warn("⚠️ Change School button not found");
      }
    }
  </script>

  <script src="js/app.js"></script>

    <!-- remove the static app.js include above (if present) and use this block below -->
  <script>
  document.addEventListener("DOMContentLoaded", async () => {
    try {
      // 1) Inject header
      const res = await fetch("/components/header.html");
      if (!res.ok) throw new Error('Failed to fetch header');
      document.getElementById("header-placeholder").innerHTML = await res.text();

      // 2) Wait for DOM parsing
      await new Promise(resolve => requestAnimationFrame(resolve));

      // 3) Load app.js dynamically
      await new Promise((resolve, reject) => {
        if (document.querySelector('script[src="/js/app.js"]')) return resolve();
        const s = document.createElement('script');
        s.src = '/js/app.js';
        s.onload = () => resolve();
        s.onerror = () => reject(new Error('Failed to load app.js'));
        document.head.appendChild(s);
      });

      // 4) Initialize everything in correct order
      if (typeof updateSchoolLogo === "function") updateSchoolLogo();
      if (typeof initializeHeader === "function") await initializeHeader();
      if (typeof updateAuthUI === "function") updateAuthUI();
      if (typeof initializeHeaderSearch === "function") initializeHeaderSearch();
      if (typeof enableAutocomplete === "function") {
        enableAutocomplete("subject-search", "index-suggestions");
        enableAutocomplete("prof-search", "header-suggestions");
      }
    // ✅ Initialize Create Review button after modal + header exist
const reviewBtn = document.getElementById("btn-create-review");
if (reviewBtn) {
  reviewBtn.addEventListener("click", () => {
    showModal(`
      <h2>Select a Professor</h2>
      <input id="search-review-prof" placeholder="Search professor..." style="margin-bottom:10px;width:100%;padding:8px;" />
      <div id="review-prof-container" style="max-height:300px;overflow:auto;"></div>
    `);

    const input = document.getElementById("search-review-prof");
    const container = document.getElementById("review-prof-container");

    async function loadProfs(q = "") {
      const res = await api.searchProfs(q);
      const list = res.professors || [];
      container.innerHTML = list
        .map(p => `<div class="card" data-id="${p.id}" style="cursor:pointer;margin-bottom:5px;">${p.name}</div>`)
        .join("");

      container.querySelectorAll(".card").forEach(c => {
        c.onclick = () => {
          window.location.href = `/review.html?prof=${c.dataset.id}`;
        };
      });
    }

    input.addEventListener("input", e => loadProfs(e.target.value));
    loadProfs();
  });
}

      console.log("✅ Header and app initialized (index)");
    } catch (err) {
      console.error("❌ Initialization failed:", err);
    }
  });
</script>

</body>
</html>
